// to build this diagram, install graphviz and run the following command:
// dot -o architecture.pdf -T pdf architecture.dot
// note: ordering=out seems to be not working due to a bug in graphviz
digraph graphname {
    size=6;
    ranksep=1.2;
    nodesep=0.8;
    mclimit=2;

    subgraph cluster_interpreter {
        label="interpreter";
        subgraph cluster_parser {
            label="parser";
            desugar;
            bind;
            operators;
            parse;
            subgraph cluster_lexer {
                label="lexer";
                scan;
                lex;
                subgraph cluster_shared {
                    label="shared";
                    objects;
                    ast;
                }
            }
        }
        main;
        serialize;
        closure;
        subgraph cluster_evaluator {
            label="evaluator";
            evaluate;
            builtins;
        }
    }

    objects -> ast;

    bind -> ast;
    bind -> lex;

    builtins -> ast;
    builtins -> objects;
    builtins -> lex;
    builtins -> closure;

    desugar -> ast;
    desugar -> lex;
    desugar -> objects;

    evaluate -> ast;
    evaluate -> serialize;
    evaluate -> builtins;
    evaluate -> closure;

    lex -> scan;
    lex -> ast;
    lex -> objects;

    serialize -> closure;
    serialize -> ast;
    serialize -> lex;

    main -> parse;
    main -> evaluate;
    main -> serialize;
    main -> objects;
    main -> closure;
    main -> ast;

    operators -> ast;
    operators -> lex;

    parse -> lex;
    parse -> operators;
    parse -> objects;
    parse -> desugar;
    parse -> bind;
    parse -> serialize;
    parse -> ast;
}
